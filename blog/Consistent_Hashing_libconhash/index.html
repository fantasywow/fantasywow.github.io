<!DOCTYPE HTML>

    <html lang="zh-Hans">
  
<head>
  <meta charset="utf-8">
  
  <title>Consistent Hashing一致性哈希库libconhash的使用与实现 | LucKy_one&#39;s blog</title>
  <meta name="author" content="Liu Tianhe">
  
  <meta name="description" content="闲着没事看了看一致性哈希，找了个开源库libconhash看看如何实现。整过过程非常清晰，代码也非常易懂，注释也非常全，带sample，简直就是开源库的典范！！">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Consistent Hashing一致性哈希库libconhash的使用与实现"/>
  <meta property="og:site_name" content="LucKy_one&#39;s blog"/>

  
    <meta property="og:image" content="undefined"/>
  

  
    <meta http-equiv="Content-Language" content="zh-Hans"/>
  

  <link href="/img/favicon.ico" rel="icon">
  
    <link rel="apple-touch-icon" href="/img/apple-icon.png">
    <link rel="apple-touch-icon-precomposed" href="/img/apple-icon.png">
    

  <link rel="alternate" href="/atom.xml" title="LucKy_one&#39;s blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  
  <!-- Chinese readability improment -->
  <style type="text/css">
    article {font-weight: 400;letter-spacing: .01rem;}
    article .entry{line-height:2;}
  </style>
  
  
  <style type="text/css">
  /* Tim Pietrusky advanced checkbox hack (Android <= 4.1.2) */
body{ -webkit-animation: bugfix infinite 1s; }
@-webkit-keyframes bugfix { from {padding:0;} to {padding:0;} }
</style>

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-51092894-1', 'auto');
  ga('send', 'pageview');
 
</script>




  
    
      <link href='//fonts.lug.ustc.edu.cn/css?family=Open+Sans:300,400|Playball' rel='stylesheet' type='text/css'>
    
  <link href='http://apps.bdimg.com/libs/fontawesome/4.1.0/css/font-awesome.css' rel='stylesheet' type='text/css'>
  <script src="http://libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>
  

  <!-- 百度统计  -->
  <script>
  var _hmt = _hmt || [];
  (function() {
   var hm = document.createElement("script");
   hm.src = "https://hm.baidu.com/hm.js?1e76131925f8a8a74864fc1a14e02837";
   var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
  </script>

</head>


<body>
  <header id="header" class="inner"><div class="padding">
	<div class="alignleft logo">
	  <h1><a href="/">LucKy_one&#39;s blog</a></h1>
	</div>
	<nav id="main-nav" class="alignright">
		<input type="checkbox" id="toggle" />
		<label for="toggle" class="toggle" data-open="Main Menu" data-close="Close Menu" onclick><i class="fa fa-bars"></i></label>
	  <ul class="menu">
	    
	      <li><a href="/">Home</a></li>
	    
	      <li><a href="/archives">Archives</a></li>
	    
	      <li><a href="/about">About</a></li>
	    
	    
	    	<li><a href="/atom.xml" target="_blank" title="bruce tan blog rss" class="rss-top"><i class="fa fa-rss"></i></a></li>
	    
	  </ul>
	</nav>
	<div class="clearfix"></div>
</div>
</header>
  <div id="page-heading-wrap">
  	<div class="inner">
      <div class="padding">
    		
          <h1>Consistent Hashing一致性哈希库libconhash的使用与实现</h1>
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2014-08-06T15:04:59.000Z">2014-08-06</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">Liu Tianhe</a>
                

              </li>
            
          </ul>
        
      </div>
  	</div>
  </div>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper" class="padding"><article class="post">
  
  
    <div class="post-content">
  
      
      <div class="entry">
        
          <p><strong>闲着没事看了看一致性哈希，找了个开源库libconhash看看如何实现。</strong><br><strong>整过过程非常清晰，代码也非常易懂，注释也非常全，带sample，简直就是开源库的典范！！</strong><br><a href="http://sourceforge.net/projects/libconhash/" target="_blank" rel="external">libconhash的sourceforge下载地址</a>  </p>
<p>From wikipedia    </p>
<blockquote>
<p><strong>一致哈希</strong> 是一种特殊的哈希算法。在使用一致哈希算法后，哈希表槽位数（大小）的改变平均只需要对K/n 个关键字重新映射，其中 K是关键字的数量，n是槽位数量。然而在传统的哈希表中，添加或删除一个槽位的几乎需要对所有关键字进行重新映射。<br><strong>需求</strong>:在使用n台缓存服务器时，一种常用的负载均衡方式是，对资源o的请求使用hash(o) = o mod n来映射到某一台缓存服务器。当增加或减少一台缓存服务器时这种方式可能会改变所有资源对应的hash值，也就是所有的缓存都失效了，这会使得缓存服务器大量集中地向原始内容服务器更新缓存。因些需要一致哈希算法来避免这样的问题。 一致哈希尽可能使同一个资源映射到同一台缓存服务器。这种方式要求增加一台缓存服务器时，新的服务器尽量分担存储其他所有服务器的缓存资源。减少一台缓存服务器时，其他所有服务器也可以尽量分担存储它的缓存资源。 一致哈希算法的主要思想是将每个缓存服务器与一个或多个哈希值域区间关联起来，其中区间边界通过计算缓存服务器对应的哈希值来决定。（定义区间的哈希函数不一定和计算缓存服务器哈希值的函数相同，但是两个函数的返回值的范围需要匹配。）如果一个缓存服务器被移除，则它会从对应的区间会被并入到邻近的区间，其他的缓存服务器不需要任何改变。<br><strong>实现</strong>:一致哈希将每个对象映射到圆环边上的一个点，系统再将可用的节点机器映射到圆环的不同位置。查找某个对象对应的机器时，需要用一致哈希算法计算得到对象对应圆环边上位置，沿着圆环边上查找直到遇到某个节点机器，这台机器即为对象应该保存的位置。 当删除一台节点机器时，这台机器上保存的所有对象都要移动到下一台机器。添加一台机器到圆环边上某个点时，这个点的下一台机器需要将这个节点前对应的对象移动到新机器上。 更改对象在节点机器上的分布可以通过调整节点机器的位置来实现。</p>
</blockquote>
<p>#使用方式<br>首先进行初始化<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">struct conhash_s *conhash = conhash_init(NULL);</div></pre></td></tr></table></figure></p>
<p>其中参数是个函数指针，指定将字符串转成long int的hash函数。默认hash函数的实现是:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">long</span> __conhash_hash_def(<span class="keyword">const</span> <span class="keyword">char</span> *instr)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> i;</div><div class="line">    <span class="keyword">long</span> hash = <span class="number">0</span>;</div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> digest[<span class="number">16</span>];</div><div class="line">    conhash_md5_digest((<span class="keyword">const</span> u_char*)instr, digest);</div><div class="line"></div><div class="line">    <span class="comment">/* use successive 4-bytes from hash as numbers */</span></div><div class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</div><div class="line">    &#123;</div><div class="line">        hash += ((<span class="keyword">long</span>)(digest[i*<span class="number">4</span> + <span class="number">3</span>]&amp;<span class="number">0xFF</span>) &lt;&lt; <span class="number">24</span>)</div><div class="line">            | ((<span class="keyword">long</span>)(digest[i*<span class="number">4</span> + <span class="number">2</span>]&amp;<span class="number">0xFF</span>) &lt;&lt; <span class="number">16</span>)</div><div class="line">            | ((<span class="keyword">long</span>)(digest[i*<span class="number">4</span> + <span class="number">1</span>]&amp;<span class="number">0xFF</span>) &lt;&lt;  <span class="number">8</span>)</div><div class="line">            | ((<span class="keyword">long</span>)(digest[i*<span class="number">4</span> + <span class="number">0</span>]&amp;<span class="number">0xFF</span>));</div><div class="line">    &#125;</div><div class="line">	<span class="keyword">return</span> hash;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">struct node_s g_nodes[64];</div></pre></td></tr></table></figure>
<p>node_s是标识节点的结构体，定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">struct node_s</div><div class="line">&#123;</div><div class="line">    char iden[64]; /* node name or some thing identifies the node */</div><div class="line">    u_int replicas; /* number of replica virtual nodes */</div><div class="line">    u_int flag;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>接下来是设置节点以及将添加节点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">/* set nodes */</div><div class="line">conhash_set_node(&amp;g_nodes[0], &quot;titanic&quot;, 32);</div><div class="line">/* add nodes */</div><div class="line">conhash_add_node(conhash, &amp;g_nodes[0]);</div></pre></td></tr></table></figure>
<p>其中<strong>titanic</strong>是这个节点的唯一标识符也就是node_s中的iden，一般可以用机器名或IP地址。而后面的<strong>32</strong>则代表这个节点对应的虚拟节点的数量replicas，一般来说一个节点的虚拟节点数占总的虚拟节点数的比重越大，那么分配到这个节点的条目也就越多。<br>flag是标识节点状态的，有<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#define NODE_FLAG_INIT  0x01 /* node is initialized */</div><div class="line">#define NODE_FLAG_IN    0x02 /* node is added in the server */</div></pre></td></tr></table></figure></p>
<p>两种状态</p>
<p>删除节点与查询：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">conhash_del_node(conhash, &amp;g_nodes[0]);</div><div class="line">struct node_s node = conhash_lookup(conhash, str);</div></pre></td></tr></table></figure></p>
<p>释放资源：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">conhash_fini(conhash);</div></pre></td></tr></table></figure></p>
<p>#内部实现原理</p>
<p>libconhash使用红黑树来保存虚拟节点。当一个节点插入后，生成所有的虚拟节点标识符字符串，并进行hash运算转成long之后插入到红黑树。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">//replicas是节点的虚拟节点数量</div><div class="line">for(i = 0; i &lt; node-&gt;replicas; i++)</div><div class="line">&#123;</div><div class="line">    //生成虚拟几点的标识符</div><div class="line">    __conhash_node2string(node, i, buff, &amp;len);</div><div class="line">    //计算标识符的hash，cb_hashfunc是初始化时制定的hash函数指针</div><div class="line">    hash = conhash-&gt;cb_hashfunc(buff);</div><div class="line">    //如果红黑树种没有存在的话就插入其中。</div><div class="line">    if(util_rbtree_search(&amp;(conhash-&gt;vnode_tree), hash) == NULL)</div><div class="line">    &#123;</div><div class="line">        //生成红黑树节点</div><div class="line">        rbnode = __conhash_get_rbnode(node, hash);</div><div class="line">        if(rbnode != NULL)</div><div class="line">        &#123;</div><div class="line">            //生成成功就插入到红黑树中</div><div class="line">            util_rbtree_insert(&amp;(conhash-&gt;vnode_tree), rbnode);</div><div class="line">            conhash-&gt;ivnodes++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中生成红黑树节点的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">util_rbtree_node_t *__conhash_get_rbnode(struct node_s *node, long hash)</div><div class="line">&#123;</div><div class="line">    util_rbtree_node_t *rbnode;</div><div class="line">    rbnode = (util_rbtree_node_t *)malloc(sizeof(util_rbtree_node_t));</div><div class="line">    if(rbnode != NULL)</div><div class="line">    &#123;</div><div class="line">        rbnode-&gt;key = hash;</div><div class="line">        rbnode-&gt;data = malloc(sizeof(struct virtual_node_s));</div><div class="line">        if(rbnode-&gt;data != NULL)</div><div class="line">        &#123;</div><div class="line">            struct virtual_node_s *vnode = rbnode-&gt;data;</div><div class="line">            vnode-&gt;hash = hash;</div><div class="line">            vnode-&gt;node = node;</div><div class="line">        &#125;</div><div class="line">        else</div><div class="line">        &#123;</div><div class="line">            free(rbnode);</div><div class="line">            rbnode = NULL;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return rbnode;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>virtual_node_s保存了hash值和实际节点的指针：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">struct virtual_node_s</div><div class="line">&#123;</div><div class="line">	long hash;</div><div class="line">	struct node_s *node; /* pointer to node */</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>而删除节点就是将红黑树中的它的所有虚拟节点删除<br>其中虚拟节点标识符的生成规则是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">_snprintf_s(buf, 127, _TRUNCATE, &quot;%s-%03d&quot;, node-&gt;iden, replica_idx);</div></pre></td></tr></table></figure></p>
<p>而查找的流程就是计算查找对象的hash然后查找红黑树中比他大的最小节点如果没有比他大的就选择最小的节点。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">hash = conhash-&gt;cb_hashfunc(object);</div><div class="line">rbnode = util_rbtree_lookup(&amp;(conhash-&gt;vnode_tree), hash);</div><div class="line">if(rbnode != NULL)</div><div class="line">&#123;</div><div class="line">	struct virtual_node_s *vnode = rbnode-&gt;data;</div><div class="line">	return vnode-&gt;node;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>红黑树的查找代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">if((rbtree != NULL) &amp;&amp; !util_rbtree_isempty(rbtree))</div><div class="line">&#123;</div><div class="line">	util_rbtree_node_t *node = NULL;</div><div class="line">	util_rbtree_node_t *temp = rbtree-&gt;root;</div><div class="line">	util_rbtree_node_t *null = _NULL(rbtree);</div><div class="line">	while(temp != null)</div><div class="line">	&#123;</div><div class="line">		if(key &lt;= temp-&gt;key)</div><div class="line">		&#123;</div><div class="line">			node = temp; /* update node */</div><div class="line">			temp = temp-&gt;left;</div><div class="line">		&#125;</div><div class="line">		else if(key &gt; temp-&gt;key)</div><div class="line">		&#123;</div><div class="line">			temp = temp-&gt;right;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	/* if node==NULL return the minimum node */</div><div class="line">	return ((node != NULL) ? node : util_rbtree_min(rbtree));</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

        
      </div>
      <footer>
        
          
          
  
  <div class="tags">
    <a href="/tags/Consistent-Hashing/">Consistent Hashing</a>
  </div>

          <div class="share">
  
</div>
          
<nav class="article-nav clearfix">
 
 <div class="article-prev" >
 <a href="/blog/fix_content-type_to_Applicationjson_in_WebApi/" title="限定ASP.NET Web API返回对象的Content-Type为application/json">
  <i class="fa fa-long-arrow-left"></i>
  <span>
  限定ASP.NET Web API返回对象的Content-Type为application/json</span>
</a>
</div>


<div class="article-next">
<a href="/blog/java_implement_muilt_inheritance/"  title="java实现多继承(转载)">
 <span>java实现多继承(转载)
</span>
<i class="fa fa-long-arrow-right"></i>
</a>
</div>

</nav>

        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>


<section id="comment">
<div id="disqus_thread"></div>
<script>

/*disqus代码*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://www-luckyonecn-com.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>

</section>

</div></div>
    <aside id="sidebar" class="alignright"><div class="padding">
	
	  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:www.luckyonecn.com">
  </form>
</div>
	
	  
<div class="widget recent-post">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/blog/2018-reading-list/">2018闲书阅读书目</a>
      </li>
    
      <li>
        <a href="/blog/Robo-Advisor/">智能投顾</a>
      </li>
    
      <li>
        <a href="/blog/2017-reading-list/">2017闲书阅读书目</a>
      </li>
    
      <li>
        <a href="/blog/effectively-final-JDK-8/">JDK8中的effectively final</a>
      </li>
    
      <li>
        <a href="/blog/junit-jndi-Spring/">在Spring中使用Junit4测试时访问JNDI资源</a>
      </li>
    
  </ul>
</div>

	
	  
	
	  
<div class="widget tag">
  <h3 class="title">标签</h3>
  
    <a href="/tags/CXF/">CXF<small>2</small></a>
  
    <a href="/tags/Consistent-Hashing/">Consistent Hashing<small>1</small></a>
  
    <a href="/tags/DNS/">DNS<small>1</small></a>
  
    <a href="/tags/DOMAIN/">DOMAIN<small>1</small></a>
  
    <a href="/tags/GZIP/">GZIP<small>1</small></a>
  
    <a href="/tags/Git/">Git<small>1</small></a>
  
    <a href="/tags/H2/">H2<small>1</small></a>
  
    <a href="/tags/JAVA/">JAVA<small>1</small></a>
  
    <a href="/tags/JNDI/">JNDI<small>1</small></a>
  
    <a href="/tags/Junit4/">Junit4<small>1</small></a>
  
    <a href="/tags/Map/">Map<small>1</small></a>
  
    <a href="/tags/SPI-Service-Provider-Interface/">SPI(Service Provider Interface)<small>1</small></a>
  
    <a href="/tags/Spring/">Spring<small>2</small></a>
  
    <a href="/tags/Web-API/">Web API<small>1</small></a>
  
    <a href="/tags/Web-Service/">Web Service<small>2</small></a>
  
    <a href="/tags/WebSphere/">WebSphere<small>1</small></a>
  
    <a href="/tags/WhirlyGlobe/">WhirlyGlobe<small>1</small></a>
  
    <a href="/tags/algorithm/">algorithm<small>2</small></a>
  
    <a href="/tags/hexo/">hexo<small>2</small></a>
  
    <a href="/tags/iOS/">iOS<small>1</small></a>
  
    <a href="/tags/java/">java<small>2</small></a>
  
    <a href="/tags/nodejs/">nodejs<small>1</small></a>
  
    <a href="/tags/sql/">sql<small>1</small></a>
  
    <a href="/tags/web/">web<small>1</small></a>
  
    <a href="/tags/windows8开发/">windows8开发<small>2</small></a>
  
    <a href="/tags/理财/">理财<small>1</small></a>
  
</div>

	
</div></aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="padding">
	<div class="alignleft">
	  
	  &copy; 2019 Liu Tianhe
	  
	  Powerd by <a href="http://hexo.io/" target="_blank">hexo</a>
	  and Theme by <a href="https://github.com/halfer53/metro-light" target="_blank">metro-light</a>
	</div>

	<div class="alignright">
		
		
			<a href="https://github.com/https://github.com/fantasywow" target="_blank" title="Liu Tianhe Github"><i class="fa fa-github-square"></i></a>	
		
		
		
		
		
		
			<a href="/atom.xml" target="_blank" title="Liu Tianhe RSS"><i class="fa fa-rss-square"></i></a>
		
	</div>

	<div class="clearfix"></div>
</div>

<div class="scroll-top"><i class="fa fa-arrow-circle-up"></i></div></footer>
  


<script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/3.0.4/jquery.imagesloaded.js"></script>
<script src="/js/gallery.js"></script>



<script type="text/javascript">
$(window).scroll(function() {

    if($(this).scrollTop() > 400) {
        $('.scroll-top').fadeIn(200);
    } else {
        $('.scroll-top').fadeOut(200);
    }
});

$('.scroll-top').bind('click', function(e) {
    e.preventDefault();
    $('body,html').animate({scrollTop:0},200);
});
</script>


</body>
</html>
